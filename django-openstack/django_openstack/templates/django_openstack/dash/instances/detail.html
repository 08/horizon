{% extends 'django_openstack/dash/base.html' %}

{% block sidebar %}
  {% with current_sidebar="instances" %}
    {{block.super}}
  {% endwith %}
{% endblock %}

{% block page_header %}
  {# to make searchable false, just remove it from the include statement #}
  {% include "django_openstack/common/_page_header.html" with title="Instance Detail" %}
{% endblock page_header %}

{% block dash_main %}
<ul id="instance_tabs">
  <li class="active"><a class="overview" href="#">Overview</a></li>
  <li><a class="log" href="#">Log</a></li>
  
  {# <li><a href="#">Snapshots</a></li> #}
  {# <li><a href="#">VNC Console</a></li> #}
  {# <li><a href="#">Metrics</a></li> #}
  {# <li><a href="#">Volumes</a></li> #}
  {# <li><a href="#">Security Groups</a></li> #}

</ul>

  <div class="dash_block">
    <div id="overview" class="tab_wrapper">
      <ul>
        <li>
          <div class="status">
            <h4>Status</h4>
            <ul>
              <li><span>Status:</span> {{instance.status}}</li>
              <li><span>Instance ID:</span> {{instance.id}}</li>
            </ul>
          </div>
        </li>

        <li>
          <div class="specs">
            <h4>Specs</h4>
            <ul>
              <li><span>RAM:</span> {{instance.attrs.memory_mb}}</li>
              <li><span>VCPUs:</span> {{instance.attrs.vcpus}} VCPU</li>
              <li><span>Disk:</span> {{instance.attrs.disk_gb}}GB Disk</li>
            </ul>
          </div>
        </li>

        <li>
          <div class="meta">
            <h4>Meta</h4>
            <ul>
              <li><span>Key name:</span> {{instance.attrs.key_name}}</li>
              <li><span>Instance Name:</span> {{instance.name}}</li>
              <li><span>Security Group(s):</span> {% for group in instance.attrs.security_groups %}{{group}}, {% endfor %}</li>
              <li><span>Image Name:</span> {{instance.image_name}}</li>
            </ul>
          </div>
        </li>
      </ul>
    </div>

    <div id="log" class="tab_wrapper">
      <pre class="logs"></pre>
    </div>
    
  </div>
{% endblock %}

{% block footer_js %}
  <script type="text/javascript" charset="utf-8">
    $(function(){
      $(".dash_block div.tab_wrapper").hide()
      $(".dash_block div.tab_wrapper:first").show()
      
      $("#instance_tabs a").click(function(e){
        e.preventDefault();
        e.stopPropagation()
        $(".dash_block div").hide('fast')
        $(".dash_block div#"+$(this).attr('class')).show('fast')

        $("#instance_tabs li").removeClass('active')
        $(this).parent().toggleClass('active')
      })
      
      setInterval(function(){
        $.get("{% url dash_instances_console request.user.tenant_id instance.id %}", function(data){
          $("#log .logs").html(data)
          console.log('done')
        })
      }, 3000)
    })
  </script>
{% endblock footer_js %}
